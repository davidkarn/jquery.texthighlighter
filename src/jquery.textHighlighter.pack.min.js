/*
 jQuery Text Highlighter
 Copyright (C) 2011 - 2013 by mirz

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,x,v,w){var t;function s(e,d){this.context=e;this.$context=a(e);this.options=a.extend({},a[u.name].defaults,d);this.init()}t=1;var u={name:"textHighlighter"};s.prototype={init:function(){this.$context.addClass(this.options.contextClass);this.bindEvents()},destroy:function(){this.unbindEvents();this.$context.removeClass(this.options.contextClass);this.$context.removeData(u.name)},bindEvents:function(){this.$context.bind("mouseup",{self:this},this.highlightHandler)},unbindEvents:function(){this.$context.unbind("mouseup",
this.highlightHandler)},highlightHandler:function(a){a.data.self.doHighlight()},doHighlight:function(){var e=this.getCurrentRange();if(e&&!e.collapsed){var d=e.toString();if(!0==this.options.onBeforeHighlight(e)){var f=a.textHighlighter.createWrapper(this.options),e=this.highlightRange(e,f),e=this.normalizeHighlights(e);this.options.onAfterHighlight(e,d)}this.removeAllRanges()}},getCurrentRange:function(){var a=this.getCurrentSelection(),d;0<a.rangeCount&&(d=a.getRangeAt(0));return d},removeAllRanges:function(){this.getCurrentSelection().removeAllRanges()},
getCurrentSelection:function(){var e=this.getCurrentWindow(),d;e.getSelection?d=e.getSelection():a("iframe").length?a("iframe",top.document).each(function(){if(this.contentWindow===e)return d=rangy.getIframeSelection(this),!1}):d=rangy.getSelection();return d},getCurrentWindow:function(){var a=this.getCurrentDocument();return a.defaultView?a.defaultView:a.parentWindow},getCurrentDocument:function(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange:function(e,
d){if(!e.collapsed){var f="SCRIPT STYLE SELECT BUTTON OBJECT APPLET".split(" "),n=e.startContainer,g=e.endContainer,r=e.commonAncestorContainer,m=!0;if(0==e.endOffset){for(;!g.previousSibling&&g.parentNode!=r;)g=g.parentNode;g=g.previousSibling}else 3==g.nodeType?e.endOffset<g.nodeValue.length&&g.splitText(e.endOffset):0<e.endOffset&&(g=g.childNodes.item(e.endOffset-1));3==n.nodeType?e.startOffset==n.nodeValue.length?m=!1:0<e.startOffset&&(n=n.splitText(e.startOffset),g==n.previousSibling&&(g=n)):
n=e.startOffset<n.childNodes.length?n.childNodes.item(e.startOffset):n.nextSibling;var r=!1,p=[];do{if(m&&3==n.nodeType){if(/\S/.test(n.nodeValue)){var m=d.clone(!0).get(0),c=n.parentNode;if(a.contains(this.context,c)||c===this.context)m=a(n).wrap(m).parent().get(0),p.push(m)}m=!1}n!=g||g.hasChildNodes()&&m||(r=!0);-1!=a.inArray(n.tagName,f)&&(m=!1);m&&n.hasChildNodes()?n=n.firstChild:null!=n.nextSibling?(n=n.nextSibling,m=!0):(n=n.parentNode,m=!1)}while(!r);return p}},normalizeHighlights:function(e){this.flattenNestedHighlights(e);
this.mergeSiblingHighlights(e);return a.map(e,function(a){return"undefined"!=typeof a.parentElement?null!=a.parentElement?a:null:null!=a.parentNode?a:null})},flattenNestedHighlights:function(e){var d=this;a.each(e,function(f){var n=a(this),g=n.parent(),r=g.prev(),m=g.next();d.isHighlight(g)&&(g.css("background-color")!=n.css("background-color")?(d.isHighlight(r)&&(!n.get(0).previousSibling&&r.css("background-color")!=g.css("background-color")&&r.css("background-color")==n.css("background-color"))&&
n.insertAfter(r),d.isHighlight(m)&&(!n.get(0).nextSibling&&m.css("background-color")!=g.css("background-color")&&m.css("background-color")==n.css("background-color"))&&n.insertBefore(m),g.is(":empty")&&g.remove()):(n=v.createTextNode(g.text()),g.empty(),g.append(n),a(e[f]).remove()))})},mergeSiblingHighlights:function(e){function d(d,g){return g&&g.nodeType==t&&a(d).css("background-color")==a(g).css("background-color")&&a(g).hasClass(f.options.highlightedClass)?!0:!1}var f=this;a.each(e,function(){var f=
this.previousSibling,g=this.nextSibling;if(d(this,f)){var e=a(f).text()+a(this).text();a(this).text(e);a(f).remove()}d(this,g)&&(e=a(this).text()+a(g).text(),a(this).text(e),a(g).remove())})},setColor:function(a){this.options.color=a},getColor:function(){return this.options.color},removeHighlights:function(e){var d=this;this.getAllHighlights(e!==w?e:this.context,!0).each(function(){if(!0==d.options.onRemoveHighlight(this)){var f=a(this).contents().unwrap().get(0),n=f.previousSibling,g=f.nextSibling;
n&&3==n.nodeType&&(f.nodeValue=n.nodeValue+f.nodeValue,n.parentNode.removeChild(n));g&&3==g.nodeType&&(f.nodeValue+=g.nodeValue,g.parentNode.removeChild(g))}})},getAllHighlights:function(e,d){var f="."+this.options.highlightedClass,f=a(e).find(f);!0==d&&a(e).hasClass(this.options.highlightedClass)&&(f=f.add(e));return f},isHighlight:function(a){return a.hasClass(this.options.highlightedClass)},serializeHighlights:function(){var e=this.getAllHighlights(this.context),d=this.context,f=[];e.each(function(n,
g){var e=0,m=g.firstChild.length,p=g,c=[];do{var l=a.inArray(p,p.parentNode.childNodes);c.unshift(l);p=p.parentNode}while(p!==d);p=a(g).clone().empty().get(0).outerHTML;g.previousSibling&&3===g.previousSibling.nodeType&&(e=g.previousSibling.length);f.push([p,a(g).text(),c.join(":"),e,m])});return JSON.stringify(f)},deserializeHighlights:function(e){try{var d=JSON.parse(e)}catch(f){throw"Can't parse serialized highlights: "+f;}var n=[],g=[],r=[0,0],m=[0,0],p=this;a.each(d,function(c,l){try{for(var d=
l[0],f=l[2].split(":"),e=l[3],I=l[4],D=f.pop(),E=null,t=p.context;(E=f.shift())!==w;)t=t.childNodes[E];t.childNodes[D-1]&&3===t.childNodes[D-1].nodeType&&(D-=1);var s=t.childNodes[D].splitText(e);s.splitText(I);s.nextSibling&&""==s.nextSibling.nodeValue&&s.parentNode.removeChild(s.nextSibling);s.previousSibling&&""==s.previousSibling.nodeValue&&s.parentNode.removeChild(s.previousSibling);var v=a(s).wrap(d).parent().get(0);m=l[2].split(":");var u;a:{for(var d=r,f=m,x=Math.min(d.length,f.length),e=
0;e<x-1;){if(Number.parseInt(d[e])!=Number.parseInt(f[e])){u=!1;break a}e++}u=Number.parseInt(d[e])==Number.parseInt(f[e])-1?!0:!1}u||g.push([]);console.log({arec:u,currentPath:m,lastPath:r});g[g.length-1].push(v);r=m;n.push(v)}catch(H){return console&&console.warn&&console.warn("Can't deserialize "+c+"-th descriptor. Cause: "+H),!0}});return g}};a.fn.getHighlighter=function(){return this.data(u.name)};a.fn[u.name]=function(e){return this.each(function(){a.data(this,u.name)||a.data(this,u.name,new s(this,
e))})};a.textHighlighter={createWrapper:function(e){return a("<span></span>").css("backgroundColor",e.color).addClass(e.highlightedClass)},defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}}}})(jQuery,window,document);window.rangy=function(){function a(c,l){var a=typeof c[l];return"function"==a||!("object"!=a||!c[l])||"unknown"==a}function x(c,l){return!("object"!=typeof c[l]||!c[l])}function v(c,l){return"undefined"!=typeof c[l]}function w(c){return function(l,a){for(var d=a.length;d--;)if(!c(l,a[d]))return!1;return!0}}function t(c){return c&&r(c,g)&&p(c,n)}function s(l){window.alert("Rangy not supported in your browser. Reason: "+l);c.initialized=!0;c.supported=!1}function u(){if(!c.initialized){var g,e=!1,n=
!1;a(document,"createRange")&&(g=document.createRange(),r(g,f)&&p(g,d)&&(e=!0),g.detach());(g=x(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(g,"createTextRange")&&(g=g.createTextRange(),t(g)&&(n=!0));e||n||s("Neither Range nor TextRange are implemented");c.initialized=!0;c.features={implementsDomRange:e,implementsTextRange:n};e=C.concat(l);n=0;for(g=e.length;n<g;++n)try{e[n](c)}catch(m){x(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
m)}}}function e(c){this.name=c;this.supported=this.initialized=!1}var d="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),f="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),n="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),
g="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),r=w(a),m=w(x),p=w(v),c={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:x,isHostProperty:v,areHostMethods:r,areHostObjects:m,areHostProperties:p,isTextRange:t},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};c.fail=s;c.warn=function(l){l="Rangy warning: "+l;c.config.alertOnWarn?window.alert(l):
"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(l)};({}).hasOwnProperty?c.util.extend=function(c,l){for(var a in l)l.hasOwnProperty(a)&&(c[a]=l[a])}:s("hasOwnProperty not supported");var l=[],C=[];c.init=u;c.addInitListener=function(a){c.initialized?a(c):l.push(a)};var A=[];c.addCreateMissingNativeApiListener=function(c){A.push(c)};c.createMissingNativeApi=function(c){c=c||window;u();for(var l=0,a=A.length;l<a;++l)A[l](c)};e.prototype.fail=function(c){this.initialized=
!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+c);};e.prototype.warn=function(l){c.warn("Module "+this.name+": "+l)};e.prototype.createError=function(c){return Error("Error in Rangy "+this.name+" module: "+c)};c.createModule=function(l,a){var d=new e(l);c.modules[l]=d;C.push(function(c){a(c,d);d.initialized=!0;d.supported=!0})};c.requireModules=function(l){for(var a=0,d=l.length,f,g;a<d;++a){g=l[a];f=c.modules[g];if(!(f&&f instanceof e))throw Error("Module '"+g+"' not found");
if(!f.supported)throw Error("Module '"+g+"' not supported");}};var G=!1,m=function(){G||(G=!0,c.initialized||u())};if("undefined"==typeof window)s("No window found");else if("undefined"==typeof document)s("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),a(window,"addEventListener")?window.addEventListener("load",m,!1):a(window,"attachEvent")?window.attachEvent("onload",m):s("Window does not have required addEventListener or attachEvent method"),
c}();
rangy.createModule("DomUtil",function(a,x){function v(c){for(var l=0;c=c.previousSibling;)l++;return l}function w(c,l){var a=[],d;for(d=c;d;d=d.parentNode)a.push(d);for(d=l;d;d=d.parentNode)if(p(a,d))return d;return null}function t(c,l,a){for(a=a?c:c.parentNode;a;){c=a.parentNode;if(c===l)return a;a=c}return null}function s(c){c=c.nodeType;return 3==c||4==c||8==c}function u(c,l){var a=l.nextSibling,d=l.parentNode;a?d.insertBefore(c,a):d.appendChild(c);return c}function e(c){if(9==c.nodeType)return c;if("undefined"!=
typeof c.ownerDocument)return c.ownerDocument;if("undefined"!=typeof c.document)return c.document;if(c.parentNode)return e(c.parentNode);throw Error("getDocument: no document found for node");}function d(c){return c?s(c)?'"'+c.data+'"':1==c.nodeType?"<"+c.nodeName+(c.id?' id="'+c.id+'"':"")+">["+c.childNodes.length+"]":c.nodeName:"[No node]"}function f(c){this._next=this.root=c}function n(c,a){this.node=c;this.offset=a}function g(c){this.code=this[c];this.codeName=c;this.message="DOMException: "+
this.codeName}var r=a.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||x.fail("document missing a Node creation method");r.isHostMethod(document,"getElementsByTagName")||x.fail("document missing getElementsByTagName method");var m=document.createElement("div");r.areHostMethods(m,["insertBefore","appendChild","cloneNode"])||x.fail("Incomplete Element implementation");r.isHostProperty(m,"innerHTML")||x.fail("Element is missing innerHTML property");m=document.createTextNode("test");
r.areHostMethods(m,["splitText","deleteData","insertData","appendData","cloneNode"])||x.fail("Incomplete Text Node implementation");var p=function(c,a){for(var d=c.length;d--;)if(c[d]===a)return!0;return!1};f.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var c=this._current=this._next,a;if(this._current){if(!(a=c.firstChild))for(a=null;c!==this.root&&!(a=c.nextSibling);)c=c.parentNode;this._next=a}return this._current},detach:function(){this._current=this._next=this.root=
null}};n.prototype={equals:function(c){return this.node===c.node&this.offset==c.offset},inspect:function(){return"[DomPosition("+d(this.node)+":"+this.offset+")]"}};g.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};g.prototype.toString=function(){return this.message};a.dom={arrayContains:p,isHtmlNamespace:function(c){var a;return"undefined"==typeof c.namespaceURI||null===(a=c.namespaceURI)||
"http://www.w3.org/1999/xhtml"==a},parentElement:function(c){c=c.parentNode;return 1==c.nodeType?c:null},getNodeIndex:v,getNodeLength:function(c){var a;return s(c)?c.length:(a=c.childNodes)?a.length:0},getCommonAncestor:w,isAncestorOf:function(c,a,d){for(a=d?a:a.parentNode;a;){if(a===c)return!0;a=a.parentNode}return!1},getClosestAncestorIn:t,isCharacterDataNode:s,insertAfter:u,splitDataNode:function(c,a){var d=c.cloneNode(!1);d.deleteData(0,a);c.deleteData(a,c.length-a);u(d,c);return d},getDocument:e,
getWindow:function(c){c=e(c);if("undefined"!=typeof c.defaultView)return c.defaultView;if("undefined"!=typeof c.parentWindow)return c.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(c){if("undefined"!=typeof c.contentWindow)return c.contentWindow;if("undefined"!=typeof c.contentDocument)return c.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(c){if("undefined"!=typeof c.contentDocument)return c.contentDocument;
if("undefined"!=typeof c.contentWindow)return c.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(c){return r.isHostObject(c,"body")?c.body:c.getElementsByTagName("body")[0]},getRootContainer:function(c){for(var a;a=c.parentNode;)c=a;return c},comparePoints:function(c,a,d,f){var g;if(c==d)return a===f?0:a<f?-1:1;if(g=t(d,c,!0))return a<=v(g)?-1:1;if(g=t(c,d,!0))return v(g)<f?-1:1;a=w(c,d);c=c===a?a:t(c,a,!0);d=d===a?a:t(d,a,!0);if(c===
d)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(a=a.firstChild;a;){if(a===c)return-1;if(a===d)return 1;a=a.nextSibling}throw Error("Should not be here!");},inspectNode:d,fragmentFromNodeChildren:function(a){for(var d=e(a).createDocumentFragment(),f;f=a.firstChild;)d.appendChild(f);return d},createIterator:function(a){return new f(a)},DomPosition:n};a.DOMException=g});
rangy.createModule("DomRange",function(a){function x(k,b){return 3!=k.nodeType&&(h.isAncestorOf(k,b.startContainer,!0)||h.isAncestorOf(k,b.endContainer,!0))}function v(k){return h.getDocument(k.startContainer)}function w(k,b,a){if(b=k._listeners[b])for(var c=0,d=b.length;c<d;++c)b[c].call(k,{target:k,args:a})}function t(k){return new L(k.parentNode,h.getNodeIndex(k))}function s(k){return new L(k.parentNode,h.getNodeIndex(k)+1)}function u(k,b,a){var c=11==k.nodeType?k.firstChild:k;h.isCharacterDataNode(b)?
a==b.length?h.insertAfter(k,b):b.parentNode.insertBefore(k,0==a?b:h.splitDataNode(b,a)):a>=b.childNodes.length?b.appendChild(k):b.insertBefore(k,b.childNodes[a]);return c}function e(k){for(var b,a,c=v(k.range).createDocumentFragment();a=k.next();){b=k.isPartiallySelectedSubtree();a=a.cloneNode(!b);b&&(b=k.getSubtreeIterator(),a.appendChild(e(b)),b.detach(!0));if(10==a.nodeType)throw new F("HIERARCHY_REQUEST_ERR");c.appendChild(a)}return c}function d(k,b,a){var c,q;for(a=a||{stop:!1};c=k.next();)if(k.isPartiallySelectedSubtree())if(!1===
b(c)){a.stop=!0;break}else{if(c=k.getSubtreeIterator(),d(c,b,a),c.detach(!0),a.stop)break}else for(c=h.createIterator(c);q=c.next();)if(!1===b(q)){a.stop=!0;return}}function f(k){for(var b;k.next();)k.isPartiallySelectedSubtree()?(b=k.getSubtreeIterator(),f(b),b.detach(!0)):k.remove()}function n(k){for(var b,a=v(k.range).createDocumentFragment(),c;b=k.next();){k.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=k.getSubtreeIterator(),b.appendChild(n(c)),c.detach(!0)):k.remove();if(10==b.nodeType)throw new F("HIERARCHY_REQUEST_ERR");
a.appendChild(b)}return a}function g(k,b,a){var c=!(!b||!b.length),q,l=!!a;c&&(q=RegExp("^("+b.join("|")+")$"));var f=[];d(new m(k,!1),function(k){c&&!q.test(k.nodeType)||l&&!a(k)||f.push(k)});return f}function r(k){return"["+("undefined"==typeof k.getName?"Range":k.getName())+"("+h.inspectNode(k.startContainer)+":"+k.startOffset+", "+h.inspectNode(k.endContainer)+":"+k.endOffset+")]"}function m(k,b){this.range=k;this.clonePartiallySelectedTextNodes=b;if(!k.collapsed){this.sc=k.startContainer;this.so=
k.startOffset;this.ec=k.endContainer;this.eo=k.endOffset;var a=k.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==a||h.isCharacterDataNode(this.sc)?h.getClosestAncestorIn(this.sc,a,!0):this.sc.childNodes[this.so],this._last=this.ec!==a||h.isCharacterDataNode(this.ec)?h.getClosestAncestorIn(this.ec,a,!0):this.ec.childNodes[this.eo-1])}}function p(k){this.code=this[k];
this.codeName=k;this.message="RangeException: "+this.codeName}function c(k,b,a){this.nodes=g(k,b,a);this._next=this.nodes[0];this._position=0}function l(k){return function(b,a){for(var c,d=a?b:b.parentNode;d;){c=d.nodeType;if(h.arrayContains(k,c))return d;d=d.parentNode}return null}}function C(k,b){if(ea(k,b))throw new p("INVALID_NODE_TYPE_ERR");}function A(k){if(!k.startContainer)throw new F("INVALID_STATE_ERR");}function G(k,b){if(!h.arrayContains(b,k.nodeType))throw new p("INVALID_NODE_TYPE_ERR");
}function I(k,b){if(0>b||b>(h.isCharacterDataNode(k)?k.length:k.childNodes.length))throw new F("INDEX_SIZE_ERR");}function D(b,a){if(U(b,!0)!==U(a,!0))throw new F("WRONG_DOCUMENT_ERR");}function E(b){if(fa(b,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR");}function B(b,a){if(!b)throw new F(a);}function J(b){return!!b.startContainer&&!!b.endContainer&&!(!h.arrayContains(P,b.startContainer.nodeType)&&!U(b.startContainer,!0))&&!(!h.arrayContains(P,b.endContainer.nodeType)&&!U(b.endContainer,!0))&&b.startOffset<=
(h.isCharacterDataNode(b.startContainer)?b.startContainer.length:b.startContainer.childNodes.length)&&b.endOffset<=(h.isCharacterDataNode(b.endContainer)?b.endContainer.length:b.endContainer.childNodes.length)}function y(b){A(b);if(!J(b))throw Error("Range error: Range is no longer valid after DOM mutation ("+b.inspect()+")");}function O(){}function K(b){b.START_TO_START=V;b.START_TO_END=Z;b.END_TO_END=ga;b.END_TO_START=$;b.NODE_BEFORE=aa;b.NODE_AFTER=ba;b.NODE_BEFORE_AND_AFTER=ca;b.NODE_INSIDE=W}
function H(b){K(b);K(b.prototype)}function Q(b,a){return function(){y(this);var c=this.startContainer,q=this.startOffset,l=this.commonAncestorContainer,f=new m(this,!0);c!==l&&(c=h.getClosestAncestorIn(c,l,!0),q=s(c),c=q.node,q=q.offset);d(f,E);f.reset();l=b(f);f.detach();a(this,c,q,c,q);return l}}function S(b,c,d){function l(b,k){return function(a){A(this);G(a,M);G(q(a),P);a=(b?t:s)(a);(k?g:e)(this,a.node,a.offset)}}function g(b,a,k){var d=b.endContainer,l=b.endOffset;if(a!==b.startContainer||k!==
b.startOffset){if(q(a)!=q(d)||1==h.comparePoints(a,k,d,l))d=a,l=k;c(b,a,k,d,l)}}function e(b,a,k){var d=b.startContainer,l=b.startOffset;if(a!==b.endContainer||k!==b.endOffset){if(q(a)!=q(d)||-1==h.comparePoints(a,k,d,l))d=a,l=k;c(b,d,l,a,k)}}b.prototype=new O;a.util.extend(b.prototype,{setStart:function(b,a){A(this);C(b,!0);I(b,a);g(this,b,a)},setEnd:function(b,a){A(this);C(b,!0);I(b,a);e(this,b,a)},setStartBefore:l(!0,!0),setStartAfter:l(!1,!0),setEndBefore:l(!0,!1),setEndAfter:l(!1,!1),collapse:function(b){y(this);
b?c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(b){A(this);C(b,!0);c(this,b,0,b,h.getNodeLength(b))},selectNode:function(b){A(this);C(b,!1);G(b,M);var a=t(b);b=s(b);c(this,a.node,a.offset,b.node,b.offset)},extractContents:Q(n,c),deleteContents:Q(f,c),canSurroundContents:function(){y(this);E(this.startContainer);E(this.endContainer);var b=new m(this,!0),a=b._first&&
x(b._first,this)||b._last&&x(b._last,this);b.detach();return!a},detach:function(){d(this)},splitBoundaries:function(){y(this);var b=this.startContainer,a=this.startOffset,k=this.endContainer,d=this.endOffset,q=b===k;h.isCharacterDataNode(k)&&0<d&&d<k.length&&h.splitDataNode(k,d);h.isCharacterDataNode(b)&&(0<a&&a<b.length)&&(b=h.splitDataNode(b,a),q?(d-=a,k=b):k==b.parentNode&&d>=h.getNodeIndex(b)&&d++,a=0);c(this,b,a,k,d)},normalizeBoundaries:function(){y(this);var b=this.startContainer,a=this.startOffset,
k=this.endContainer,d=this.endOffset,q=function(b){var a=b.nextSibling;a&&a.nodeType==b.nodeType&&(k=b,d=b.length,b.appendData(a.data),a.parentNode.removeChild(a))},l=function(c){var q=c.previousSibling;if(q&&q.nodeType==c.nodeType){b=c;var l=c.length;a=q.length;c.insertData(0,q.data);q.parentNode.removeChild(q);b==k?(d+=a,k=b):k==c.parentNode&&(q=h.getNodeIndex(c),d==q?(k=c,d=l):d>q&&d--)}},f=!0;h.isCharacterDataNode(k)?k.length==d&&q(k):(0<d&&(f=k.childNodes[d-1])&&h.isCharacterDataNode(f)&&q(f),
f=!this.collapsed);f?h.isCharacterDataNode(b)?0==a&&l(b):a<b.childNodes.length&&(q=b.childNodes[a])&&h.isCharacterDataNode(q)&&l(q):(b=k,a=d);c(this,b,a,k,d)},collapseToPoint:function(b,a){A(this);C(b,!0);I(b,a);b===this.startContainer&&a===this.startOffset&&b===this.endContainer&&a===this.endOffset||c(this,b,a,b,a)}});H(b)}function R(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset;b.commonAncestorContainer=b.collapsed?b.startContainer:h.getCommonAncestor(b.startContainer,
b.endContainer)}function T(b,a,c,d,q){var l=b.startContainer!==a||b.startOffset!==c,f=b.endContainer!==d||b.endOffset!==q;b.startContainer=a;b.startOffset=c;b.endContainer=d;b.endOffset=q;R(b);w(b,"boundarychange",{startMoved:l,endMoved:f})}function z(b){this.startContainer=b;this.startOffset=0;this.endContainer=b;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};R(this)}a.requireModules(["DomUtil"]);var h=a.dom,L=h.DomPosition,F=a.DOMException;m.prototype={_current:null,_next:null,_first:null,
_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var b=this._current=this._next;b&&(this._next=b!==this._last?b.nextSibling:null,h.isCharacterDataNode(b)&&this.clonePartiallySelectedTextNodes&&(b===this.ec&&(b=b.cloneNode(!0)).deleteData(this.eo,b.length-this.eo),this._current===this.sc&&(b=b.cloneNode(!0)).deleteData(0,this.so)));return b},remove:function(){var b=this._current,a,c;!h.isCharacterDataNode(b)||
b!==this.sc&&b!==this.ec?b.parentNode&&b.parentNode.removeChild(b):(a=b===this.sc?this.so:0,c=b===this.ec?this.eo:b.length,a!=c&&b.deleteData(a,c-a))},isPartiallySelectedSubtree:function(){return x(this._current,this.range)},getSubtreeIterator:function(){var b;if(this.isSingleCharacterDataNode)b=this.range.cloneRange(),b.collapse();else{b=new z(v(this.range));var a=this._current,c=a,d=0,q=a,l=h.getNodeLength(a);h.isAncestorOf(a,this.sc,!0)&&(c=this.sc,d=this.so);h.isAncestorOf(a,this.ec,!0)&&(q=this.ec,
l=this.eo);T(b,c,d,q,l)}return new m(b,this.clonePartiallySelectedTextNodes)},detach:function(b){b&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};p.prototype.toString=function(){return this.message};c.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},
detach:function(){this._current=this._next=this.nodes=null}};var M=[1,3,4,5,7,8,10],P=[2,9,11],N=[1,3,4,5,7,8,10,11],b=[1,3,4,5,7,8],q=h.getRootContainer,U=l([9,11]),fa=l([5,6,10,12]),ea=l([6,10,12]),da=document.createElement("style"),X=!1;try{da.innerHTML="<b>x</b>",X=3==da.firstChild.nodeType}catch(ha){}a.features.htmlParsingConforms=X;var Y="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),V=0,Z=1,ga=2,$=3,aa=0,ba=1,ca=2,W=3;O.prototype={attachListener:function(b,
a){this._listeners[b].push(a)},compareBoundaryPoints:function(b,a){y(this);D(this.startContainer,a.startContainer);var c=b==$||b==V?"start":"end",d=b==Z||b==V?"start":"end";return h.comparePoints(this[c+"Container"],this[c+"Offset"],a[d+"Container"],a[d+"Offset"])},insertNode:function(b){y(this);G(b,N);E(this.startContainer);if(h.isAncestorOf(b,this.startContainer,!0))throw new F("HIERARCHY_REQUEST_ERR");this.setStartBefore(u(b,this.startContainer,this.startOffset))},cloneContents:function(){y(this);
var b,a;if(this.collapsed)return v(this).createDocumentFragment();if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return b=this.startContainer.cloneNode(!0),b.data=b.data.slice(this.startOffset,this.endOffset),a=v(this).createDocumentFragment(),a.appendChild(b),a;a=new m(this,!0);b=e(a);a.detach();return b},canSurroundContents:function(){y(this);E(this.startContainer);E(this.endContainer);var b=new m(this,!0),a=b._first&&x(b._first,this)||b._last&&x(b._last,
this);b.detach();return!a},surroundContents:function(a){G(a,b);if(!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var c=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);u(a,this.startContainer,this.startOffset);a.appendChild(c);this.selectNode(a)},cloneRange:function(){y(this);for(var b=new z(v(this)),a=Y.length,c;a--;)c=Y[a],b[c]=this[c];return b},toString:function(){y(this);var b=this.startContainer;if(b===this.endContainer&&h.isCharacterDataNode(b))return 3==
b.nodeType||4==b.nodeType?b.data.slice(this.startOffset,this.endOffset):"";var a=[],b=new m(this,!0);d(b,function(b){3!=b.nodeType&&4!=b.nodeType||a.push(b.data)});b.detach();return a.join("")},compareNode:function(b){y(this);var a=b.parentNode,c=h.getNodeIndex(b);if(!a)throw new F("NOT_FOUND_ERR");b=this.comparePoint(a,c);a=this.comparePoint(a,c+1);return 0>b?0<a?ca:aa:0<a?ba:W},comparePoint:function(b,a){y(this);B(b,"HIERARCHY_REQUEST_ERR");D(b,this.startContainer);return 0>h.comparePoints(b,a,
this.startContainer,this.startOffset)?-1:0<h.comparePoints(b,a,this.endContainer,this.endOffset)?1:0},createContextualFragment:X?function(b){var a=this.startContainer,c=h.getDocument(a);if(!a)throw new F("INVALID_STATE_ERR");var d=null;1==a.nodeType?d=a:h.isCharacterDataNode(a)&&(d=h.parentElement(a));d=null===d||"HTML"==d.nodeName&&h.isHtmlNamespace(h.getDocument(d).documentElement)&&h.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1);d.innerHTML=b;return h.fragmentFromNodeChildren(d)}:
function(b){A(this);var a=v(this).createElement("body");a.innerHTML=b;return h.fragmentFromNodeChildren(a)},toHtml:function(){y(this);var b=v(this).createElement("div");b.appendChild(this.cloneContents());return b.innerHTML},intersectsNode:function(b,a){y(this);B(b,"NOT_FOUND_ERR");if(h.getDocument(b)!==v(this))return!1;var c=b.parentNode,d=h.getNodeIndex(b);B(c,"NOT_FOUND_ERR");var q=h.comparePoints(c,d,this.endContainer,this.endOffset),c=h.comparePoints(c,d+1,this.startContainer,this.startOffset);
return a?0>=q&&0<=c:0>q&&0<c},isPointInRange:function(b,a){y(this);B(b,"HIERARCHY_REQUEST_ERR");D(b,this.startContainer);return 0<=h.comparePoints(b,a,this.startContainer,this.startOffset)&&0>=h.comparePoints(b,a,this.endContainer,this.endOffset)},intersectsRange:function(b,a){y(this);if(v(b)!=v(this))throw new F("WRONG_DOCUMENT_ERR");var c=h.comparePoints(this.startContainer,this.startOffset,b.endContainer,b.endOffset),d=h.comparePoints(this.endContainer,this.endOffset,b.startContainer,b.startOffset);
return a?0>=c&&0<=d:0>c&&0<d},intersection:function(b){if(this.intersectsRange(b)){var a=h.comparePoints(this.startContainer,this.startOffset,b.startContainer,b.startOffset),c=h.comparePoints(this.endContainer,this.endOffset,b.endContainer,b.endOffset),d=this.cloneRange();-1==a&&d.setStart(b.startContainer,b.startOffset);1==c&&d.setEnd(b.endContainer,b.endOffset);return d}return null},union:function(b){if(this.intersectsRange(b,!0)){var a=this.cloneRange();-1==h.comparePoints(b.startContainer,b.startOffset,
this.startContainer,this.startOffset)&&a.setStart(b.startContainer,b.startOffset);1==h.comparePoints(b.endContainer,b.endOffset,this.endContainer,this.endOffset)&&a.setEnd(b.endContainer,b.endOffset);return a}throw new p("Ranges do not intersect");},containsNode:function(b,a){return a?this.intersectsNode(b,!1):this.compareNode(b)==W},containsNodeContents:function(b){return 0<=this.comparePoint(b,0)&&0>=this.comparePoint(b,h.getNodeLength(b))},containsRange:function(b){return this.intersection(b).equals(b)},
containsNodeText:function(b){var a=this.cloneRange();a.selectNode(b);var c=a.getNodes([3]);return 0<c.length?(a.setStart(c[0],0),b=c.pop(),a.setEnd(b,b.length),b=this.containsRange(a),a.detach(),b):this.containsNodeContents(b)},createNodeIterator:function(b,a){y(this);return new c(this,b,a)},getNodes:function(b,a){y(this);return g(this,b,a)},getDocument:function(){return v(this)},collapseBefore:function(b){A(this);this.setEndBefore(b);this.collapse(!1)},collapseAfter:function(b){A(this);this.setStartAfter(b);
this.collapse(!0)},getName:function(){return"DomRange"},equals:function(b){return z.rangesEqual(this,b)},isValid:function(){return J(this)},inspect:function(){return r(this)}};S(z,T,function(b){A(b);b.startContainer=b.startOffset=b.endContainer=b.endOffset=null;b.collapsed=b.commonAncestorContainer=null;w(b,"detach",null);b._listeners=null});a.rangePrototype=O.prototype;z.rangeProperties=Y;z.RangeIterator=m;z.copyComparisonConstants=H;z.createPrototypeRange=S;z.inspect=r;z.getRangeDocument=v;z.rangesEqual=
function(b,a){return b.startContainer===a.startContainer&&b.startOffset===a.startOffset&&b.endContainer===a.endContainer&&b.endOffset===a.endOffset};a.DomRange=z;a.RangeException=p});
rangy.createModule("WrappedRange",function(a){function x(a,f,e,g){var r=a.duplicate();r.collapse(e);var m=r.parentElement();t.isAncestorOf(f,m,!0)||(m=f);if(!m.canHaveHTML)return new s(m.parentNode,t.getNodeIndex(m));f=t.getDocument(m).createElement("span");var p,c=e?"StartToStart":"StartToEnd";do m.insertBefore(f,f.previousSibling),r.moveToElementText(f);while(0<(p=r.compareEndPoints(c,a))&&f.previousSibling);c=f.nextSibling;if(-1==p&&c&&t.isCharacterDataNode(c)){r.setEndPoint(e?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(c.data))for(m=r.duplicate(),e=m.text.replace(/\r\n/g,"\r").length,e=m.moveStart("character",e);-1==m.compareEndPoints("StartToEnd",m);)e++,m.moveStart("character",1);else e=r.text.length;m=new s(c,e)}else c=(g||!e)&&f.previousSibling,m=(e=(g||e)&&f.nextSibling)&&t.isCharacterDataNode(e)?new s(e,0):c&&t.isCharacterDataNode(c)?new s(c,c.length):new s(m,t.getNodeIndex(f));f.parentNode.removeChild(f);return m}function v(a,f){var e,g,r=a.offset,m=t.getDocument(a.node),p=m.body.createTextRange(),
c=t.isCharacterDataNode(a.node);c?(e=a.node,g=e.parentNode):(e=a.node.childNodes,e=r<e.length?e[r]:null,g=a.node);m=m.createElement("span");m.innerHTML="&#feff;";e?g.insertBefore(m,e):g.appendChild(m);p.moveToElementText(m);p.collapse(!f);g.removeChild(m);if(c)p[f?"moveStart":"moveEnd"]("character",r);return p}a.requireModules(["DomUtil","DomRange"]);var w,t=a.dom,s=t.DomPosition,u=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function d(a){for(var c=
e.length,d;c--;)d=e[c],a[d]=a.nativeRange[d]}var f,e=u.rangeProperties,g,r;w=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;d(this)};u.createPrototypeRange(w,function(a,c,d,f,e){var g=a.endContainer!==f||a.endOffset!=e;if(a.startContainer!==c||a.startOffset!=d||g)a.setEnd(f,e),a.setStart(c,d)},function(a){a.nativeRange.detach();a.detached=!0;for(var c=e.length,d;c--;)d=e[c],a[d]=null});f=w.prototype;f.selectNode=function(a){this.nativeRange.selectNode(a);d(this)};f.deleteContents=
function(){this.nativeRange.deleteContents();d(this)};f.extractContents=function(){var a=this.nativeRange.extractContents();d(this);return a};f.cloneContents=function(){return this.nativeRange.cloneContents()};f.surroundContents=function(a){this.nativeRange.surroundContents(a);d(this)};f.collapse=function(a){this.nativeRange.collapse(a);d(this)};f.cloneRange=function(){return new w(this.nativeRange.cloneRange())};f.refresh=function(){d(this)};f.toString=function(){return this.nativeRange.toString()};
var m=document.createTextNode("test");t.getBody(document).appendChild(m);var p=document.createRange();p.setStart(m,0);p.setEnd(m,0);try{p.setStart(m,1),g=!0,f.setStart=function(a,c){this.nativeRange.setStart(a,c);d(this)},f.setEnd=function(a,c){this.nativeRange.setEnd(a,c);d(this)},r=function(a){return function(c){this.nativeRange[a](c);d(this)}}}catch(c){g=!1,f.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(f){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}d(this)},
f.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(f){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}d(this)},r=function(a,c){return function(f){try{this.nativeRange[a](f)}catch(e){this.nativeRange[c](f),this.nativeRange[a](f)}d(this)}}}f.setStartBefore=r("setStartBefore","setEndBefore");f.setStartAfter=r("setStartAfter","setEndAfter");f.setEndBefore=r("setEndBefore","setStartBefore");f.setEndAfter=r("setEndAfter","setStartAfter");p.selectNodeContents(m);f.selectNodeContents=
p.startContainer==m&&p.endContainer==m&&0==p.startOffset&&p.endOffset==m.length?function(a){this.nativeRange.selectNodeContents(a);d(this)}:function(a){this.setStart(a,0);this.setEnd(a,u.getEndOffset(a))};p.selectNodeContents(m);p.setEnd(m,3);g=document.createRange();g.selectNodeContents(m);g.setEnd(m,4);g.setStart(m,2);f.compareBoundaryPoints=-1==p.compareBoundaryPoints(p.START_TO_END,g)&1==p.compareBoundaryPoints(p.END_TO_START,g)?function(a,c){c=c.nativeRange||c;a==c.START_TO_END?a=c.END_TO_START:
a==c.END_TO_START&&(a=c.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,c)}:function(a,c){return this.nativeRange.compareBoundaryPoints(a,c.nativeRange||c)};a.util.isHostMethod(p,"createContextualFragment")&&(f.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});t.getBody(document).removeChild(m);p.detach();g.detach()})(),a.createNativeRange=function(a){a=a||document;return a.createRange()};else if(a.features.implementsTextRange){w=function(a){this.textRange=
a;this.refresh()};w.prototype=new u(document);w.prototype.refresh=function(){var a,f,e=this.textRange;a=e.parentElement();var g=e.duplicate();g.collapse(!0);f=g.parentElement();g=e.duplicate();g.collapse(!1);e=g.parentElement();f=f==e?f:t.getCommonAncestor(f,e);f=f==a?f:t.getCommonAncestor(a,f);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?f=a=x(this.textRange,f,!0,!0):(a=x(this.textRange,f,!0,!1),f=x(this.textRange,f,!1,!1));this.setStart(a.node,a.offset);this.setEnd(f.node,f.offset)};
u.copyComparisonConstants(w);var e=function(){return this}();"undefined"==typeof e.Range&&(e.Range=w);a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()}}a.features.implementsTextRange&&(w.rangeToTextRange=function(a){if(a.collapsed)return v(new s(a.startContainer,a.startOffset),!0);var f=v(new s(a.startContainer,a.startOffset),!0),e=v(new s(a.endContainer,a.endOffset),!1);a=t.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",f);a.setEndPoint("EndToEnd",
e);return a});w.prototype.getName=function(){return"WrappedRange"};a.WrappedRange=w;a.createRange=function(d){d=d||document;return new w(a.createNativeRange(d))};a.createRangyRange=function(a){a=a||document;return new u(a)};a.createIframeRange=function(d){return a.createRange(t.getIframeDocument(d))};a.createIframeRangyRange=function(d){return a.createRangyRange(t.getIframeDocument(d))};a.addCreateMissingNativeApiListener(function(d){d=d.document;"undefined"==typeof d.createRange&&(d.createRange=
function(){return a.createRange(this)});d=d=null})});
rangy.createModule("WrappedSelection",function(a,x){function v(b){return(b||window).getSelection()}function w(b){return(b||window).document.selection}function t(b,a,c){var d=c?"end":"start";c=c?"start":"end";b.anchorNode=a[d+"Container"];b.anchorOffset=a[d+"Offset"];b.focusNode=a[c+"Container"];b.focusOffset=a[c+"Offset"]}function s(b){b.anchorNode=b.focusNode=null;b.anchorOffset=b.focusOffset=0;b.rangeCount=0;b.isCollapsed=!0;b._ranges.length=0}function u(b){var d;b instanceof C?(d=b._selectionNativeRange,
d||(d=a.createNativeRange(c.getDocument(b.startContainer)),d.setEnd(b.endContainer,b.endOffset),d.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=d,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof A?d=b.nativeRange:a.features.implementsDomRange&&b instanceof c.getWindow(b.startContainer).Range&&(d=b);return d}function e(b){var a=b.getNodes(),d;a:if(a.length&&1==a[0].nodeType){d=1;for(var e=a.length;d<e;++d)if(!c.isAncestorOf(a[0],a[d])){d=!1;break a}d=
!0}else d=!1;if(!d)throw Error("getSingleElementFromRange: range "+b.inspect()+" did not consist of a single element");return a[0]}function d(b,a){var c=new A(a);b._ranges=[c];t(b,c,!1);b.rangeCount=1;b.isCollapsed=c.collapsed}function f(b){b._ranges.length=0;if("None"==b.docSelection.type)s(b);else{var q=b.docSelection.createRange();if(q&&"undefined"!=typeof q.text)d(b,q);else{b.rangeCount=q.length;for(var e,f=c.getDocument(q.item(0)),g=0;g<b.rangeCount;++g)e=a.createRange(f),e.selectNode(q.item(g)),
b._ranges.push(e);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;t(b,b._ranges[b.rangeCount-1],!1)}}}function n(b,a){for(var d=b.docSelection.createRange(),g=e(a),h=c.getDocument(d.item(0)),h=c.getBody(h).createControlRange(),l=0,m=d.length;l<m;++l)h.add(d.item(l));try{h.add(g)}catch(n){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}h.select();f(b)}function g(b,a,c){this.nativeSelection=b;this.docSelection=a;this._ranges=
[];this.win=c;this.refresh()}function r(b,a){for(var d=c.getDocument(a[0].startContainer),d=c.getBody(d).createControlRange(),g=0,h;g<rangeCount;++g){h=e(a[g]);try{d.add(h)}catch(l){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();f(b)}function m(b,a){if(b.anchorNode&&c.getDocument(b.anchorNode)!==c.getDocument(a))throw new G("WRONG_DOCUMENT_ERR");}function p(b){var a=[],c=new I(b.anchorNode,b.anchorOffset),
d=new I(b.focusNode,b.focusOffset),e="function"==typeof b.getName?b.getName():"Selection";if("undefined"!=typeof b.rangeCount)for(var f=0,g=b.rangeCount;f<g;++f)a[f]=C.inspect(b.getRangeAt(f));return"["+e+"(Ranges: "+a.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var c=a.dom,l=a.util,C=a.DomRange,A=a.WrappedRange,G=a.DOMException,I=c.DomPosition,D,E,B=a.util.isHostMethod(window,"getSelection"),
J=a.util.isHostObject(document,"selection"),y=J&&(!B||a.config.preferTextRange);y?(D=w,a.isSelectionValid=function(b){b=(b||window).document;var a=b.selection;return"None"!=a.type||c.getDocument(a.createRange().parentElement())==b}):B?(D=v,a.isSelectionValid=function(){return!0}):x.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=D;var B=D(),O=a.createNativeRange(document),K=c.getBody(document),H=l.areHostObjects(B,l.areHostProperties(B,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=H;var Q=l.isHostMethod(B,"extend");a.features.selectionHasExtend=Q;var S="number"==typeof B.rangeCount;a.features.selectionHasRangeCount=S;var R=!1,T=!0;l.areHostMethods(B,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof B.rangeCount&&a.features.implementsDomRange&&function(){var b=document.createElement("iframe");b.frameBorder=0;b.style.position="absolute";b.style.left="-10000px";K.appendChild(b);var a=c.getIframeDocument(b);a.open();a.write("<html><head></head><body>12</body></html>");
a.close();var d=c.getIframeWindow(b).getSelection(),e=a.documentElement.lastChild.firstChild,a=a.createRange();a.setStart(e,1);a.collapse(!0);d.addRange(a);T=1==d.rangeCount;d.removeAllRanges();var f=a.cloneRange();a.setStart(e,0);f.setEnd(e,2);d.addRange(a);d.addRange(f);R=2==d.rangeCount;a.detach();f.detach();K.removeChild(b)}();a.features.selectionSupportsMultipleRanges=R;a.features.collapsedNonEditableSelectionsSupported=T;var z=!1,h;K&&l.isHostMethod(K,"createControlRange")&&(h=K.createControlRange(),
l.areHostProperties(h,["item","add"])&&(z=!0));a.features.implementsControlRange=z;E=H?function(b){return b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset}:function(b){return b.rangeCount?b.getRangeAt(b.rangeCount-1).collapsed:!1};var L;l.isHostMethod(B,"getRangeAt")?L=function(b,a){try{return b.getRangeAt(a)}catch(c){return null}}:H&&(L=function(b){var d=c.getDocument(b.anchorNode),d=a.createRange(d);d.setStart(b.anchorNode,b.anchorOffset);d.setEnd(b.focusNode,b.focusOffset);d.collapsed!==
this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset));return d});a.getSelection=function(b){b=b||window;var a=b._rangySelection,c=D(b),d=J?w(b):null;a?(a.nativeSelection=c,a.docSelection=d,a.refresh(b)):(a=new g(c,d,b),b._rangySelection=a);return a};a.getIframeSelection=function(b){return a.getSelection(c.getIframeWindow(b))};h=g.prototype;if(!y&&H&&l.areHostMethods(B,["removeAllRanges","addRange"])){h.removeAllRanges=function(){this.nativeSelection.removeAllRanges();
s(this)};var F=function(b,c){var d=C.getRangeDocument(c),d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(u(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};h.addRange=S?function(b,c){if(z&&J&&"Control"==this.docSelection.type)n(this,b);else if(c&&Q)F(this,b);else{var d;R?d=this.rangeCount:(this.removeAllRanges(),d=0);this.nativeSelection.addRange(u(b));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==d+1?(a.config.checkSelectionRanges&&
(d=L(this.nativeSelection,this.rangeCount-1))&&!C.rangesEqual(d,b)&&(b=new A(d)),this._ranges[this.rangeCount-1]=b,t(this,b,N(this.nativeSelection)),this.isCollapsed=E(this)):this.refresh()}}:function(b,a){a&&Q?F(this,b):(this.nativeSelection.addRange(u(b)),this.refresh())};h.setRanges=function(b){if(z&&1<b.length)r(this,b);else{this.removeAllRanges();for(var a=0,c=b.length;a<c;++a)this.addRange(b[a])}}}else if(l.isHostMethod(B,"empty")&&l.isHostMethod(O,"select")&&z&&y)h.removeAllRanges=function(){try{if(this.docSelection.empty(),
"None"!=this.docSelection.type){var b;if(this.anchorNode)b=c.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var a=this.docSelection.createRange();a.length&&(b=c.getDocument(a.item(0)).body.createTextRange())}b&&(b.body.createTextRange().select(),this.docSelection.empty())}}catch(d){}s(this)},h.addRange=function(b){"Control"==this.docSelection.type?n(this,b):(A.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,t(this,
b,!1))},h.setRanges=function(b){this.removeAllRanges();var a=b.length;1<a?r(this,b):a&&this.addRange(b[0])};else return x.fail("No means of selecting a Range or TextRange was found"),!1;h.getRangeAt=function(b){if(0>b||b>=this.rangeCount)throw new G("INDEX_SIZE_ERR");return this._ranges[b]};var M;if(y)M=function(b){var e;a.isSelectionValid(b.win)?e=b.docSelection.createRange():(e=c.getBody(b.win.document).createTextRange(),e.collapse(!0));"Control"==b.docSelection.type?f(b):e&&"undefined"!=typeof e.text?
d(b,e):s(b)};else if(l.isHostMethod(B,"getRangeAt")&&"number"==typeof B.rangeCount)M=function(b){if(z&&J&&"Control"==b.docSelection.type)f(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));t(b,b._ranges[b.rangeCount-1],N(b.nativeSelection));b.isCollapsed=E(b)}else s(b)};else if(H&&"boolean"==typeof B.isCollapsed&&"boolean"==typeof O.collapsed&&a.features.implementsDomRange)M=
function(b){var a;a=b.nativeSelection;a.anchorNode?(a=L(a,0),b._ranges=[a],b.rangeCount=1,a=b.nativeSelection,b.anchorNode=a.anchorNode,b.anchorOffset=a.anchorOffset,b.focusNode=a.focusNode,b.focusOffset=a.focusOffset,b.isCollapsed=E(b)):s(b)};else return x.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;h.refresh=function(b){var a=b?this._ranges.slice(0):null;M(this);if(b){b=a.length;if(b!=this._ranges.length)return!1;for(;b--;)if(!C.rangesEqual(a[b],this._ranges[b]))return!1;
return!0}};var P=function(b,a){var c=b.getAllRanges(),d=!1;b.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||a!==c[e]?b.addRange(c[e]):d=!0;b.rangeCount||s(b)};h.removeRange=z?function(b){if("Control"==this.docSelection.type){var a=this.docSelection.createRange();b=e(b);for(var d=c.getDocument(a.item(0)),d=c.getBody(d).createControlRange(),g,h=!1,l=0,m=a.length;l<m;++l)g=a.item(l),g!==b||h?d.add(a.item(l)):h=!0;d.select();f(this)}else P(this,b)}:function(b){P(this,b)};var N;!y&&H&&a.features.implementsDomRange?
(N=function(b){var a=!1;b.anchorNode&&(a=1==c.comparePoints(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset));return a},h.isBackwards=function(){return N(this)}):N=h.isBackwards=function(){return!1};h.toString=function(){for(var b=[],a=0,c=this.rangeCount;a<c;++a)b[a]=""+this._ranges[a];return b.join("")};h.collapse=function(b,d){m(this,b);var e=a.createRange(c.getDocument(b));e.collapseToPoint(b,d);this.removeAllRanges();this.addRange(e);this.isCollapsed=!0};h.collapseToStart=function(){if(this.rangeCount){var b=
this._ranges[0];this.collapse(b.startContainer,b.startOffset)}else throw new G("INVALID_STATE_ERR");};h.collapseToEnd=function(){if(this.rangeCount){var b=this._ranges[this.rangeCount-1];this.collapse(b.endContainer,b.endOffset)}else throw new G("INVALID_STATE_ERR");};h.selectAllChildren=function(b){m(this,b);var d=a.createRange(c.getDocument(b));d.selectNodeContents(b);this.removeAllRanges();this.addRange(d)};h.deleteFromDocument=function(){if(z&&J&&"Control"==this.docSelection.type){for(var b=this.docSelection.createRange(),
a;b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){b=this.getAllRanges();this.removeAllRanges();a=0;for(var c=b.length;a<c;++a)b[a].deleteContents();this.addRange(b[c-1])}};h.getAllRanges=function(){return this._ranges.slice(0)};h.setSingleRange=function(a){this.setRanges([a])};h.containsNode=function(a,c){for(var d=0,e=this._ranges.length;d<e;++d)if(this._ranges[d].containsNode(a,c))return!0;return!1};h.toHtml=function(){var a="";if(this.rangeCount){for(var a=
C.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;c<d;++c)a.appendChild(this._ranges[c].cloneContents());a=a.innerHTML}return a};h.getName=function(){return"WrappedSelection"};h.inspect=function(){return p(this)};h.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};g.inspect=p;a.Selection=g;a.selectionPrototype=h;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});
